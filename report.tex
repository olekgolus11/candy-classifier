\documentclass{article}

% Language setting
\usepackage[polish]{babel}

% Set page size and margins
% Replace `letterpaper' with `a4paper' for UK/EU standard size
\usepackage[letterpaper,top=2cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}

% Useful packages
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[T1]{fontenc}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}
\usepackage{lipsum}
\usepackage{multicol}
\usepackage{tikz,tcolorbox}
\usepackage{float}

\title{Metoda klasyfikacji cukierków na podstawie ich opakowania}
\author{Aleksander Golus, Bartosz Chadryś, Jakub Miśko, Igor Joński}

\begin{document}
\maketitle

\newpage

\definecolor{my-red-light}{RGB}{254, 218, 212}
\definecolor{my-red-dark}{RGB}{220, 97, 85}
\definecolor{my-orange-light}{RGB}{252, 236, 189}
\definecolor{my-orange-dark}{RGB}{247, 167, 9}
\definecolor{my-pink-light}{RGB}{252, 218, 229}
\definecolor{my-pink-dark}{RGB}{247, 132, 168}
\definecolor{my-green}{RGB}{141, 189, 16}

\section{Wstęp}
\label{Wstęp}
W projekcie opracowano metodę, która pozwala na rozpoznawanie typów cukierków na podstawie ich kolorowych opakowań oraz monitorowanie ich ilości na taśmie produkcyjnej.

Jednym z podobnych rozwiązań w tej branży (spożywczej) jest rozpoznawanie rodzajów bułek oraz ich kształtów tak jak zostało to przedstawione w \cite{virtuslab}, w przypadku tematu, jakim są cukierki, można znaleźć zastosowania w pomocy rozróżniania rodzaju cukierka w bombonierce \cite{chocolates}. Innym przypadkiem użycia detekcji obiektów na podstawie ich opakowania może być również innowacyjna metoda rozpoznawania produktów w automatach sprzedających \cite{vending}.

Metoda, którą opracowano w tym projekcie, może znaleźć zastosowanie w przemyśle spożywczym w automatyzacji procesów pakowania oraz kontroli jakości. Zapewnia ona selekcję produktów oraz może przyczynić się do usprawnienia procesów magazynowania i dystrybucji.

\section{Materiały i metody}
\label{Materiały i metody}
\subsection{Materiały badawcze}
\label{Materiały badawcze}
Materiałami badawczymi są konkretne rodzaje cukierków o kolorowych opakowaniach, to znaczy - cukierki marki Mamba oraz Turbo. Zostały one wybrane ze względu na to, że posiadają bardzo podobny rozmiar.

Wykorzystane cukierki dzielimy na 4 typy kolorów, z czego różowy, czerwony oraz pomarańczowy to cukierki marki Mamba, natomiast zielony - marki Turbo. Cukierki marki Mamba posiadają dwie barwy danego koloru - barwę jaśniejszą oraz ciemniejszą.

\begin{figure}[H]
    \centering
    \begin{tcolorbox}[colback=white]

    \begin{multicols}{4}
    Różowy cukierek
    \begin{tcolorbox}[colback=my-pink-dark, width=\linewidth, colframe=my-pink-dark]
    \end{tcolorbox}
    Czerwony cukierek
    \begin{tcolorbox}[colback=my-red-dark, width=\linewidth, colframe=my-red-dark]
    \end{tcolorbox}
    Pomarańczowy cuk.
    \begin{tcolorbox}[colback=my-orange-dark, width=\linewidth, colframe=my-orange-dark]
    \end{tcolorbox}
    Zielony cukierek
    \begin{tcolorbox}[colback=my-green, width=\linewidth, colframe=my-green]
    \end{tcolorbox}
    \end{multicols}

    \begin{multicols}{4}
    \begin{tcolorbox}[colback=my-pink-light, width=\linewidth, colframe=my-pink-light]
    \end{tcolorbox}
    \begin{tcolorbox}[colback=my-red-light, width=\linewidth, colframe=my-red-light]
    \end{tcolorbox}
    \begin{tcolorbox}[colback=my-orange-light, width=\linewidth, colframe=my-orange-light]
    \end{tcolorbox}
    \end{multicols}

    \end{tcolorbox}
    \caption{Wizualizacja barw dla każdego koloru badanego cukierka}
\end{figure}






\subsection{Przedziały kolorów rozpoznawalnych cukierków}

Kolory cukierków w określonym oświetleniu, omówionym w sekcji \ref{Układ pomiarowy}, powinny zawierać się w następujących zakresach:

\begin{table}[H]
    \label{tab:tab1}
    \centering
    \begin{tabular}{ |c|c|c|c| }
     \hline
     Kolor & Dolna granica & Górna granica \\
     \hline
     Różowy & \#32282f & \#ff0000 \\
     \hline
     Czerwony & \#645050 & \#ff7a37 \\
     \hline
     Pomarańczowy & \#644b3d & \#ffd500 \\
     \hline
     Zielony & \#323222 & \#00ff00 \\
     \hline
    \end{tabular}
    \caption{Przedziały barw, w których musi znaleźć się kolor opakowania cukierka by został zidentyfikowany.}
\end{table}

\subsection{Układ pomiarowy}
\label{Układ pomiarowy}

\begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{ukladPomiarowy.png}
    \caption{Układ pomiarowy}
    \label{fig:ukladPomiarowy}
\end{figure}

Układ pomiarowy, przedstawiony na rysunku \ref{fig:ukladPomiarowy}, składa się z ciemnozielonej taśmy produkcyjnej napędzanej silnikiem elektrycznym o stałej prędkości, kamery o rozdzielczości 1920x1080 pikseli nagrywającej w 30 klatkach na sekundę oraz lampy LED naświetlającej taśmę z góry. Ciemnozielony kolor taśmy został wybrany tak, aby nie zawierał się w przedziałach barw cukierków podanych w \ref{tab:tab1}.

Taśma produkcyjna, o szerokości 6cm, przesuwa umieszczone na niej cukierki ze stałą prędkością 3cm/s. Do oświetlenia cukierków znajdujących się na taśmie została użyta lampa ledowa o mocy 10W i temperaturze 3500K, umieszczona na wysokości 20cm, oddalona od kamery o 15cm w płaszczyźnie poziomej. Kamera została ustawiona 20cm nad taśmą, rejestrując przy tym całą szerokość taśmy.

Układ pomiarowy składa się również z obszaru detekcji, czyli miejsca, w którym zliczane są typy cukierków. Posiada on wymiary 3mm x 6cm. Jego szerokość jest równa szerokości taśmy, natomiast długość, która wyliczona na podstawie prędkości taśmy oraz ilości klatek na sekundę z jaką nagrywany jest obraz, ma na celu zapewnić, że dany cukierek przynajmniej raz znajdzie się w obszarze detekcji, możliwie jak najbardziej ograniczając ilość występowania dokładnie tego samego cukierka w tym obszarze.

\subsection{Metoda pomiarowa}
\label{Metoda pomiarowa}
\subsubsection{Idea}
\label{Idea}

Ideą metody pomiarowej, jest zliczanie cukierków umieszczonych na taśmie produkcyjnej bazując na kolorze opakowania cukierka. Przypadki użycia metody pomiarowej to między innymi:

\begin{itemize}
    \item Weryfikacja ilości cukierków w partii - czy ilość zliczonych cukierków jest zgodna z ustaloną ilością w danej partii.
    \item Weryfikacja różnorodności cukierków - czy zliczone cukierki na taśmie są wystarczająco zróżnicowane.
\end{itemize}

\subsubsection{Sposób pomiaru}
\label{Sposób pomiaru}

\begin{figure}[H]
    \centering
    \includegraphics[height=8cm]{diagramMetody.png}
    \caption{Diagram metody pomiarowej}
    \label{fig:diagramMetody}
\end{figure}

Metoda, przedstawiona na ryusnku \ref{fig:diagramMetody}, by zidentyfikować i zliczyć typ danego cukierka wykonuje następujące kroki:
\begin{enumerate}
    \item Sprawdzany zostaje kolor opakowania cukierka, który musi zawierać się w jednym z określonych w tabeli \ref{tab:tab1} przedziałach. By to określić:
    \begin{itemize}
        \item Dla każdego z 4 przedziałów barw, tworzona jest maska.
        \item Do utworzenia masek wykorzystana zostaje funkcja \verb|cv2.inRange()|\cite{inRange}, przyjmująca jako argumenty: klatkę aktualnie analizowanego obrazu w przestrzeni barw HSV, dolną oraz górną granicę danego przedziału barw.
        \item Zwrócone zostają łącznie 4 maski, po jednej dla każdego przedziału barw. \textbf{Wszystkie kolejne kroki są wykonywane dla każdej z 4 otrzymanych masek osobno}.
    \end{itemize}
    \item Sprawdzane jest pole powierzchni identyfikowanego cukierka, które musi być większe niż minimalne założone pole (30000px):
    \begin{itemize}
        \item Na każdej z otrzymanych masek wyznaczamy kontury znalezionych obiektów.
        \item Do znalezienia konturów wykorzystana zostaje funkcja \verb|cv2.findContours()|\cite{findContours}, przyjmująca jako argumenty: obraz binarny (jedna z 4 wcześniej otrzymanych masek), tryb konturów (użyliśmy \verb|RETR_EXTERNAL|, który zwraca nam tylko zewnętrzne kontury, pomijane są wszystkie zagnieżdżone wewnętrzne kontury) oraz metoda aproksymacji konturów (skorzystaliśmy z \verb|CHAIN_APPROX_SIMPLE|, która kompresuje informacje o konturze do 4 punktów wyznaczających rogi konturu, co jest dla nas wystarczającą informacją).
        \item Dla wszystkich otrzymanych konturów, obliczane jest zaznaczone przez nie pole powierzchni. Te obiekty, których pole powierzchni jest większe niż minimalne założone pole, są wykorzystywane w kolejnym kroku.
    \end{itemize}
    \item Sprawdzana jest pozycja konturu cukierka. Do analizy pozycji konturów wszystkich cukierków wykorzystaliśmy listę obserwowanych konturów, która jest aktualizowana w każdej klatce:
    \begin{itemize}
        \item Dla każdego konturu sprawdzana jest jego pozycja (środek ciężkości) na obrazie.
        \item Jeżeli w liście obserwowanych konturów istnieje kontur, którego pozycja, względem aktualnie analizowanego konturu, w poprzek ruchu taśmy nie zmieniła się (z dokładnością do 40px), to pozycja tego konturu zostaje zaktualizowana. Jeżeli nie istnieje taki kontur, to aktualnie analizowany kontur zostaje dodany do listy obserwowanych konturów.
        \item Jeżeli aktualnie analizowany kontur znajduje się w obszarze detekcji, to ilość rozpoznanego rodzaju cukierka jest zwiększana, a sam kontur otrzymuje flagę, że został już rozpoznany.
    \end{itemize}
\end{enumerate}

\section{Wyniki i dyskusja}
\label{Wyniki i dyskusja}
Skuteczność działania metody została przetestowana na wcześniej przygotowanych nagraniach taśmy produkcyjnej z umieszczonymi na niej cukierkami z których wyodrębniono przypadki.
\subsection{Przypadek 1}
Analizując rezultaty otrzymaliśmy następujące wyniki:

\begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{wykres1.png}
    \caption{Wykres rezultatów dla pierwszego przypadku}
    \label{fig:przypadek1}
\end{figure}


Metoda w przypadku 1. daje wyniki 100-tu procentowej zgodności między rzeczywistą ilością cukierków, a tą rozpoznaną przez program, dla danego koloru opakowania cukierka. Metoda poprawnie identyfikuje typy cukierków również w sytuacji, gdy dwa cukierki innych typów znajdują się jeden pod drugim.

\begin{figure}[H]
    \centering
    \includegraphics[width=6cm]{badanie.png}
    \caption{Przypadek pierwszy, w którym dwa różne typy cukierków stykają się ze sobą}
\end{figure}

\subsection{Przypadek 2}

\begin{figure}[H]
    \centering
    \includegraphics[width=\linewidth]{wykres2.png}
    \caption{Wykres rezultatów dla drugiego przypadku}
    \label{fig:przypadek2}
\end{figure}


W przypadku 2. analizowane były wyłącznie cukierki marki Mamba.


W tym przypadku metoda nie osiągnęła 100\% w żadnym z obserwowanych kolorów. Niedokładność ta wynikała z tego samego powodu. Metoda klasyfikując typ cukierka ma problem z rozpoznaniem dwóch cukierków tego samego koloru opakowania znajdujących się bezpośrednio obok siebie (stykających się ze sobą). Problem ten w przypadku 1. nie wystąpił, stąd otrzymaliśmy początkowo idealną dokładność.

\begin{center}
\begin{figure}[H]
\includegraphics[height=5cm]{pink.png}
\includegraphics[height=5cm]{orange.png}
\includegraphics[height=5cm]{red.png}
\caption{Przypadek drugi, w którym cukierki tych samych typów stykają się ze sobą}
\end{figure}
\end{center}

\section{Wnioski}
\label{Wnioski}

Projekt skoncentrował się na opracowaniu metody klasyfikacji cukierków na podstawie koloru ich opakowań. Metoda klasyfikacji osiągneła średnią skuteczność 94\%. System skutecznie identyfikuje cukierki na taśmie produkcyjnej, co może być użyteczne w branży spożywczej do zliczania ilości cukierków w partii oraz weryfikacji ich różnorodności.

Perspektywy rozwoju obejmują dalsze doskonalenie algorytmu klasyfikacji, zwłaszcza w przypadku sytuacji, gdy cukierki tego samego koloru są blisko siebie. Dodatkowo, można rozważyć rozszerzenie rozwiązania na inne produkty spożywcze o podobnych wymiarach, co zwiększyłoby zakres jego zastosowania.

\section{Literatura}
\label{Literatura}
\begin{thebibliography}{9}

\bibitem{virtuslab}
\url{https://virtuslab.com/case-study/object-detection-in-real-time-streaming-recordings-and-images}

\bibitem{gfg}
\url{https://www.geeksforgeeks.org/detect-an-object-with-opencv-python/}

\bibitem{dry}
\url{https://dontrepeatyourself.org/post/color-based-object-detection-with-opencv-and-python/}

\bibitem{yt-motorcycle}
\url{https://www.youtube.com/watch?v=O3b8lVF93jU/}

\bibitem{yt-banana}
\url{https://www.youtube.com/watch?v=aFNDh5k3SjU&t=1004s/}

\bibitem{chocolates}
\url{https://blog.roboflow.com/identifying-chocolates-with-computer-vision/}

\bibitem{vending}
 \url{https://www.researchgate.net/publication/337068624_Towards_Identification_of_Packaged_Products_via_Computer_Vision_Convolutional_Neural_Networks_for_Object_Detection_and_Image_Classification_in_Retail_Environments}

\bibitem{inRange}
\url{https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ga48af0ab51e36436c5d04340e036ce981}

\bibitem{findContours}
\url{https://docs.opencv.org/3.4/d3/dc0/group__imgproc__shape.html#ga17ed9f5d79ae97bd4c7cf18403e1689a}

\end{thebibliography}

\end{document}